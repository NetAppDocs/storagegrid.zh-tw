---
permalink: admin/configuring-load-balancer-endpoints.html 
sidebar: sidebar 
keywords: how to configure load balancer endpoint, how to attach certificate to load balancer endpoint 
summary: 負載平衡器端點決定連接到閘道和管理節點上的 StorageGRID 負載平衡器時、 S3 用戶端可以使用的連接埠和網路傳輸協定。您也可以使用端點來存取 Grid Manager 、 Tenant Manager 或兩者。 
---
= 設定負載平衡器端點
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
負載平衡器端點決定連接到閘道和管理節點上的 StorageGRID 負載平衡器時、 S3 用戶端可以使用的連接埠和網路傳輸協定。您也可以使用端點來存取 Grid Manager 、 Tenant Manager 或兩者。

.開始之前
* 您已使用登入 Grid Manager link:../admin/web-browser-requirements.html["支援的網頁瀏覽器"]。
* 您有link:admin-group-permissions.html["root 存取權限"]。
* 您已檢閱link:managing-load-balancing.html["負載平衡考量"]。
* 如果您先前已重新對應要用於負載平衡器端點的連接埠、則您有link:../maintain/removing-port-remaps.html["已移除連接埠重新對應"]。
* 您已建立任何打算使用的高可用度（HA）群組。建議使用HA群組、但不需要。請參閱。 link:managing-high-availability-groups.html["管理高可用度群組"]
* 如果負載平衡器端點將由使用link:../admin/manage-s3-select-for-tenant-accounts.html["S3租戶選擇"]、則不得使用任何裸機節點的 IP 位址或 FQDN 。S3 Select 所使用的負載平衡器端點僅允許使用服務應用裝置和 VMware 型軟體節點。
* 您已設定任何打算使用的VLAN介面。請參閱。 link:configure-vlan-interfaces.html["設定VLAN介面"]
* 如果您要建立HTTPS端點（建議）、您就有伺服器憑證的資訊。
+

NOTE: 對端點憑證所做的變更、可能需要15分鐘才能套用至所有節點。

+
** 若要上傳憑證、您需要伺服器憑證、憑證私密金鑰、以及選擇性的CA套裝組合。
** 若要產生憑證、您需要 S3 用戶端用來存取端點的所有網域名稱和 IP 位址。您也必須知道主旨（辨別名稱）。
** 如果您想要使用 StorageGRID S3 API 憑證（也可用於直接連線至儲存節點）、則您已使用外部憑證授權單位簽署的自訂憑證來取代預設憑證。請參閱。 link:../admin/configuring-custom-server-certificate-for-storage-node.html["設定 S3 API 憑證"]






== 建立負載平衡器端點

每個 S3 用戶端負載平衡器端點指定一個連接埠、一個客戶端類型（S3）和一個網路協定（HTTP 或 HTTPS）。管理介面負載平衡器端點指定連接埠、介面類型和不受信任的客戶端網路。



=== 存取精靈

.步驟
. 選擇*設定* > *網路* > *負載平衡器端點*。
. 若要為 S3 用戶端建立端點，請選擇 *S3 用戶端* 標籤。
. 若要建立端點以存取 Grid Manager 、 Tenant Manager 或兩者、請選取 * 管理介面 * 索引標籤。
. 選擇* Create *（建立*）。




=== 輸入端點詳細資料

.步驟
. 選取適當的指示、以輸入您要建立的端點類型的詳細資料。


[role="tabbed-block"]
====
.S3用戶端
--
[cols="1a,3a"]
|===
| 欄位 | 說明 


 a| 
名稱
 a| 
端點的描述性名稱、會出現在「負載平衡器端點」頁面的表格中。



 a| 
連接埠
 a| 
您要用於負載平衡的選用功能。StorageGRID此欄位預設為 10433 、表示您建立的第一個端點、但您可以輸入 1 到 65535 之間的任何未使用的外部連接埠。

如果您輸入 *80* 或 *8443* ，則端點僅在網關節點上配置，除非您已釋放端口 8443 。然後、您可以使用連接埠 8443 做為 S3 端點、而且連接埠將同時在 Gateway 和 Admin Node 上設定。



 a| 
用戶端類型
 a| 
必須是 *S3 * 。



 a| 
網路傳輸協定
 a| 
用戶端連線至此端點時所使用的網路傳輸協定。

* 選擇* HTTPS *進行安全的TLS加密通訊（建議）。您必須先附加安全性憑證、才能儲存端點。
* 選擇「* HTTP *」以獲得較不安全且未加密的通訊。僅將HTTP用於非正式作業網格。




 a| 
啟用快取
 a| 
啟用或停用link:../admin/managing-load-balancing.html#considerations-for-load-balancer-caching["網關節點上的緩存"]用於此負載平衡器端點。

如果出現快取問題，請參閱link:../troubleshoot/troubleshooting-load-balancer-caching.html["排查負載平衡器快取問題"]。

|===
--
.管理介面
--
[cols="1a,3a"]
|===
| 欄位 | 說明 


 a| 
名稱
 a| 
端點的描述性名稱、會出現在「負載平衡器端點」頁面的表格中。



 a| 
連接埠
 a| 
您要用來存取 Grid Manager 、 Tenant Manager 或兩者的 StorageGRID 連接埠。

* 網格管理器： *8443*
* 租戶經理： *9443*
* Grid Manager 和 Tenant Manager ： *443*


* 注意 * ：您可以使用這些預設連接埠或其他可用的連接埠。



 a| 
介面類型
 a| 
選取您要使用此端點存取的 StorageGRID 介面選項按鈕。



 a| 
不受信任的用戶端網路
 a| 
如果不受信任的用戶端網路應該可以存取此端點、請選取 * 是 * 。否則、請選取 * 否 * 。

當您選取 * 是 * 時、連接埠會在所有不受信任的用戶端網路上開啟。

* 注意 * ：當您建立負載平衡器端點時、您只能將連接埠設定為開放或關閉給不受信任的用戶端網路。

|===
--
====
. 選擇*繼續*。




=== 選取繫結模式

.步驟
. 選取端點的繫結模式、以控制使用任何 IP 位址或使用特定 IP 位址和網路介面存取端點的方式。
+
有些繫結模式適用於用戶端端端點或管理介面端點。此處列出兩種端點類型的所有模式。

+
[cols="1a,3a"]
|===
| 模式 | 說明 


 a| 
全域（用戶端端端點的預設值）
 a| 
用戶端可以使用任何閘道節點或管理節點的 IP 位址、任何網路上任何 HA 群組的虛擬 IP （ VIP ）位址、或對應的 FQDN 來存取端點。

除非您需要限制此端點的存取、否則請使用 * 全域 * 設定。



 a| 
HA群組的虛擬IP
 a| 
用戶端必須使用 HA 群組的虛擬 IP 位址（或對應的 FQDN ）才能存取此端點。

具有此繫結模式的端點都可以使用相同的連接埠編號、只要您為端點選取的 HA 群組不會重疊。



 a| 
節點介面
 a| 
用戶端必須使用所選節點介面的 IP 位址（或對應的 FQDN ）來存取此端點。



 a| 
節點類型（僅限用戶端端端點）
 a| 
根據您選取的節點類型、用戶端必須使用任何管理節點的 IP 位址（或對應的 FQDN ）或任何閘道節點的 IP 位址（或對應的 FQDN ）來存取此端點。



 a| 
所有管理節點（管理介面端點的預設值）
 a| 
用戶端必須使用任何管理節點的 IP 位址（或對應的 FQDN ）來存取此端點。

|===
+
如果多個端點使用相同的連接埠、 StorageGRID 會使用此優先順序來決定要使用的端點： * HA 群組的虛擬 IP * > * 節點介面 * > * 節點類型 * > * 全域 * 。

+
如果您要建立管理介面端點、則只允許使用管理節點。

. 如果您選取* HA群組的虛擬IP *、請選取一或多個HA群組。
+
如果您要建立管理介面端點、請選取僅與管理節點相關聯的 VIP 。

. 如果您選取*節點介面*、請針對您要與此端點建立關聯的每個管理節點或閘道節點、選取一或多個節點介面。
. 如果您選取 * 節點類型 * 、請選取管理節點（包括主要管理節點和任何非主要管理節點）或閘道節點。




=== 控制租戶存取


NOTE: 管理介面端點只有當端點具有<<enter-endpoint-details,租戶管理器的介面類型>>時、才能控制租戶存取。

.步驟
. 對於 * 租戶存取 * 步驟、請選取下列其中一項：
+
[cols="1a,2a"]
|===
| 欄位 | 說明 


 a| 
允許所有租戶（預設）
 a| 
所有租戶帳戶都可以使用此端點來存取他們的貯體。

如果您尚未建立任何租戶帳戶、則必須選取此選項。新增租戶帳戶之後、您可以編輯負載平衡器端點、以允許或封鎖特定帳戶。



 a| 
允許選取的租戶
 a| 
只有選取的租戶帳戶才能使用此端點存取其貯體。



 a| 
封鎖選取的租戶
 a| 
選取的租戶帳戶無法使用此端點存取其儲存區。所有其他租戶都可以使用此端點。

|===
. 如果您要建立 *HTTP* 端點、則不需要附加憑證。選取*「Create」（建立）*以新增負載平衡器端點。然後，轉至<<after-you-finish,完成後>>。否則、請選取*繼續*以附加憑證。




=== 附加憑證

.步驟
. 如果您要建立* HTTPS *端點、請選取要附加到端點的安全性憑證類型。
+
憑證可保護 S3 用戶端與管理節點或閘道節點上負載平衡器服務之間的連線。

+
** *上傳認證*。如果您有要上傳的自訂憑證、請選取此選項。
** *產生憑證*。如果您有產生自訂憑證所需的值、請選取此選項。
** * 使用 StorageGRID S3 憑證 * 。如果您想要使用全域 S3 API 憑證、也可用於直接連線至儲存節點、請選取此選項。
+
除非您以外部憑證授權單位簽署的自訂憑證取代由網格 CA 簽署的預設 S3 API 憑證、否則無法選取此選項。請參閱。 link:../admin/configuring-custom-server-certificate-for-storage-node.html["設定 S3 API 憑證"]

** * 使用管理介面憑證 * 。如果您想要使用通用管理介面憑證、也可用於直接連線至管理節點、請選取此選項。


. 如果您未使用 StorageGRID S3 憑證、請上傳或產生憑證。
+
[role="tabbed-block"]
====
.上傳憑證
--
.. 選擇*上傳憑證*。
.. 上傳所需的伺服器憑證檔案：
+
*** *伺服器憑證*：自訂伺服器憑證檔案（以PEM編碼）。
*** * 憑證私密金鑰 * ：自訂伺服器憑證私密金鑰檔案(`.key`）。
+

NOTE: EC 私密金鑰必須大於 224 位元。RSA 私密金鑰必須大於 2048 位元。

*** * CA套裝組合*：單一選用檔案、內含來自每個中繼發行憑證授權單位（CA）的憑證。檔案應包含以憑證鏈順序串聯的每個由PEE編碼的CA憑證檔案。


.. 展開*憑證詳細資料*、即可查看您上傳之每個憑證的中繼資料。如果您上傳了選用的CA套件、每個憑證都會顯示在其各自的索引標籤上。
+
*** 選取*下載憑證*以儲存憑證檔案、或選取*下載CA套件*以儲存憑證套件組合。
+
指定憑證檔案名稱和下載位置。使用副檔名儲存檔案 `.pem`。

+
例如： `storagegrid_certificate.pem`

*** 選擇*複製憑證PEP*或*複製CA套裝組合PEP*、即可複製憑證內容以貼到其他位置。


.. 選擇* Create *（建立*）。+已建立負載平衡器端點。自訂憑證用於 S3 用戶端或管理介面與端點之間的所有後續新連線。


--
.產生憑證
--
.. 選擇*產生憑證*。
.. 指定憑證資訊：
+
[cols="1a,3a"]
|===
| 欄位 | 說明 


 a| 
網域名稱
 a| 
要包含在憑證中的一或多個完整網域名稱。使用*作為萬用字元來代表多個網域名稱。



 a| 
IP
 a| 
要包含在憑證中的一或多個 IP 位址。



 a| 
主旨（選用）
 a| 
憑證擁有者的 X.509 主體或辨別名稱（ DN ）。

如果在此欄位中未輸入任何值、則產生的憑證會使用第一個網域名稱或 IP 位址做為主體一般名稱（ CN ）。



 a| 
有效天數
 a| 
憑證建立後過期的天數。



 a| 
新增金鑰使用方式擴充功能
 a| 
如果選取（預設和建議）、金鑰使用方式和延伸金鑰使用方式延伸會新增至產生的憑證。

這些延伸定義了憑證中所含金鑰的用途。

* 附註 * ：除非您在憑證包含這些副檔名時遇到舊版用戶端的連線問題、否則請保留此核取方塊。

|===
.. 選取*產生*。
.. 選取*憑證詳細資料*以查看所產生憑證的中繼資料。
+
*** 選取*下載憑證*以儲存憑證檔案。
+
指定憑證檔案名稱和下載位置。使用副檔名儲存檔案 `.pem`。

+
例如： `storagegrid_certificate.pem`

*** 選取*複製憑證PEP*以複製憑證內容以貼到其他位置。


.. 選擇* Create *（建立*）。
+
隨即建立負載平衡器端點。自訂憑證用於 S3 用戶端或管理介面與此端點之間的所有後續新連線。



--
====




=== 完成後

.步驟
. 如果您使用 DNS 、請確定 DNS 包含一筆記錄、將 StorageGRID 完整網域名稱（ FQDN ）與用戶端用來建立連線的每個 IP 位址建立關聯。
+
您在DNS記錄中輸入的IP位址取決於您是否使用HA負載平衡節點群組：

+
** 如果您已設定 HA 群組、用戶端將會連線至該 HA 群組的虛擬 IP 位址。
** 如果您不使用 HA 群組、用戶端將使用閘道節點或管理節點的 IP 位址連線至 StorageGRID 負載平衡器服務。
+
您也必須確保DNS記錄會參考所有必要的端點網域名稱、包括任何萬用字元名稱。



. 向 S3 用戶端提供連線至端點所需的資訊：
+
** 連接埠號碼
** 完整網域名稱或IP位址
** 任何必要的憑證詳細資料






== 檢視及編輯負載平衡器端點

您可以檢視現有負載平衡器端點的詳細資料、包括安全端點的憑證中繼資料。您可以變更端點的特定設定。

* 若要檢視所有負載平衡器端點的基本資訊、請檢閱「負載平衡器端點」頁面上的表格。
* 若要檢視特定端點的所有詳細資料、包括憑證中繼資料、請在表格中選取端點的名稱。顯示的資訊會因端點類型及其設定方式而異。
+
image::../media/load_balancer_endpoint_details.png[負載平衡器端點詳細資料]

* 若要編輯端點、請使用負載平衡器端點頁面上的 * 動作 * 功能表。
+

NOTE: 如果您在編輯管理介面端點的連接埠時、無法存取 Grid Manager 、請更新 URL 和連接埠以重新取得存取權。

+

TIP: 編輯端點之後、您可能需要等待15分鐘、才能將變更套用至所有節點。

+
[cols="1a, 2a,2a"]
|===
| 工作 | 「行動」功能表 | 詳細資料頁面 


 a| 
編輯端點名稱
 a| 
.. 選取端點的核取方塊。
.. 選取*「動作*」>*「編輯端點名稱*」。
.. 輸入新名稱。
.. 選擇*保存*。

 a| 
.. 選取端點名稱以顯示詳細資料。
.. 選擇編輯圖示image:../media/icon_edit_tm.png["編輯圖示"]。
.. 輸入新名稱。
.. 選擇*保存*。




 a| 
編輯端點連接埠
 a| 
.. 選取端點的核取方塊。
.. 選取 * 動作 * > * 編輯端點連接埠 *
.. 輸入有效的連接埠號碼。
.. 選擇*保存*。

 a| 
_n_



 a| 
編輯端點繫結模式
 a| 
.. 選取端點的核取方塊。
.. 選取*「動作*」>*「編輯端點繫結模式*」。
.. 視需要更新連結模式。
.. 選取*儲存變更*。

 a| 
.. 選取端點名稱以顯示詳細資料。
.. 選擇*編輯綁定模式*。
.. 視需要更新連結模式。
.. 選取*儲存變更*。




 a| 
編輯端點憑證
 a| 
.. 選取端點的核取方塊。
.. 選取*「動作*」>*「編輯端點憑證*」。
.. 視需要上傳或產生新的自訂憑證、或開始使用全域 S3 憑證。
.. 選取*儲存變更*。

 a| 
.. 選取端點名稱以顯示詳細資料。
.. 選擇*認證*標籤。
.. 選取*編輯憑證*。
.. 視需要上傳或產生新的自訂憑證、或開始使用全域 S3 憑證。
.. 選取*儲存變更*。




 a| 
編輯租戶存取
 a| 
.. 選取端點的核取方塊。
.. 選取 * 動作 * > * 編輯租戶存取 * 。
.. 選擇不同的存取選項、從清單中選取或移除租戶、或兩者都執行。
.. 選取*儲存變更*。

 a| 
.. 選取端點名稱以顯示詳細資料。
.. 選擇 * 租戶存取 * 標籤。
.. 選取 * 編輯租戶存取 * 。
.. 選擇不同的存取選項、從清單中選取或移除租戶、或兩者都執行。
.. 選取*儲存變更*。


|===




== 移除負載平衡器端點

您可以使用* Actions（動作）*功能表移除一或多個端點、也可以從詳細資料頁面移除單一端點。


CAUTION: 若要防止用戶端中斷、請在移除負載平衡器端點之前、更新任何受影響的 S3 用戶端應用程式。使用指派給另一個負載平衡器端點的連接埠、更新每個用戶端以進行連線。請務必同時更新任何必要的憑證資訊。


NOTE: 如果您在移除管理介面端點時失去對 Grid Manager 的存取權、請更新 URL 。

* 若要移除一或多個端點：
+
.. 在「負載平衡器」頁面中、選取您要移除的每個端點的核取方塊。
.. 選擇*「Actions」（動作）*>*「Remove*」（移除
.. 選擇*確定*。


* 若要從詳細資料頁面移除一個端點：
+
.. 從「負載平衡器」頁面中選取端點名稱。
.. 在詳細資料頁面上選取*移除*。
.. 選擇*確定*。



