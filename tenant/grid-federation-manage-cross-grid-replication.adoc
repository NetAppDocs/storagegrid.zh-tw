---
permalink: tenant/grid-federation-manage-cross-grid-replication.html 
sidebar: sidebar 
keywords: grid federation, cross-grid replication, use grid federation connection, replicate client delete markers, s3 bucket 
summary: 如果您的租戶帳戶在建立時已獲指派「使用網格同盟連線」權限、您可以使用跨網格複寫、在租戶來源網格上的貯體和租戶目的地網格上的貯體之間自動複寫物件。跨網格複寫可在一個或兩個方向進行。 
---
= 管理跨網格複寫
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果您的租戶帳戶在建立時已獲指派 * 使用網格同盟連線 * 權限、您可以使用跨網格複寫、在租戶來源網格上的貯體和租戶目的地網格上的貯體之間自動複寫物件。跨網格複寫可在一個或兩個方向進行。



== 跨網格複寫的工作流程

工作流程圖總結了配置兩個網格上的儲存桶之間的跨網格複製所執行的步驟。圖表下方對這些步驟進行了更詳細的描述。

image::../media/grid-federation-cgr-workflow.png[跨網格複寫工作流程]



== 設定跨網格複寫

在使用跨網格複製之前，您必須登入每個網格上對應的租用戶帳戶並建立兩個儲存桶。然後，您可以在一個或兩個儲存桶上啟用跨網格複製。

.開始之前
* 您已經查看了跨網格複製的要求。請參閱link:../admin/grid-federation-what-is-cross-grid-replication.html["什麼是跨網格複寫"] 。
* 您正在使用link:../admin/web-browser-requirements.html["支援的網頁瀏覽器"]。
* 租用戶帳戶具有*使用網格聯合連線*權限，且兩個網格上都存在相同的租用戶帳戶。請參閱link:../admin/grid-federation-manage-tenants.html["管理網格同盟連線的允許租戶"] 。
* 您登入的租戶使用者已存在於兩個網格中，並且屬於具有link:tenant-management-permissions.html["root 存取權限"]。
* 如果您以本機使用者身分登入租用戶的目標網格，則租用戶帳戶的根使用者已為您在該網格上的使用者帳戶設定了密碼。




=== 建立兩個儲存桶

第一步，登入每個網格上對應的租戶帳戶，並在每個網格上建立一個儲存桶。

.步驟
. 從網格聯盟連線的任一網格開始、建立新的儲存格：
+
.. 使用位於兩個網格上的租戶使用者身分證明登入租戶帳戶。
+
如果您無法以本機使用者身分登入租用戶的目標網格，請確認租用戶帳戶的根用戶已為您的使用者帳戶設定密碼。

.. 按照的說明進行操作link:creating-s3-bucket.html["建立 S3 儲存貯體"]。
+

TIP: 每個網格上的儲存桶名稱和區域可以不同。

.. 在 * 管理物件設定 * 索引標籤上、選取 * 啟用物件版本設定 * 。
.. 如果您的StorageGRID系統啟用了 S3 物件鎖定，請參閱link:../admin/grid-federation-what-is-cross-grid-replication.html#cgr-with-ol["使用 S3 物件鎖定進行跨網格複製"]。
.. 選取*建立桶*。
.. 選擇*完成*。


. 重複這些步驟，在網格聯合連接中的另一個網格上為相同租用戶帳戶建立儲存桶。
+

TIP: 根據需要、每個貯體可以使用不同的區域。





=== 啟用跨網格複寫

您必須先執行這些步驟、才能將任何物件新增至任一貯體。

.步驟
. 從您要複寫物件的網格開始、啟用link:../admin/grid-federation-what-is-cross-grid-replication.html["單向跨網格複寫"]：
+
.. 登入貯體的租戶帳戶。
.. 從儀表板選取 * 檢視貯體 * 、或選取 * 儲存空間（ S3 ） * > * 鏟斗 * 。
.. 從表格中選取貯體名稱、以存取貯體詳細資料頁面。
.. 選取 * 跨網格複寫 * 標籤。
.. 選取 * 啟用 * 、然後檢閱要求清單。
.. 如果符合所有需求、請選取您要使用的網格同盟連線。
.. 您也可以變更 * 複寫刪除標記 * 的設定、以判斷如果 S3 用戶端向不含版本 ID 的來源網格發出刪除要求、目的地網格上會發生什麼情況：
+
*** * 是 * （預設）：刪除標記會新增至來源貯體、並複寫至目的地貯體。
*** *否*：刪除標記已新增至來源儲存桶，但未複製到目標儲存桶。
+
image::../media/grid-federation-cross-grid-replication-client-deletes.png[顯示在兩個網格上複寫用戶端刪除的影像]

+

NOTE: 如果刪除請求包含版本 ID，則該物件版本將從來源儲存桶中永久刪除。  StorageGRID不會複製包含版本 ID 的刪除要求，因此相同的物件版本不會從目標中刪除。

+
參考link:../admin/grid-federation-what-is-cross-grid-replication.html["什麼是跨網格複寫"]了解詳情。



.. 您也可以變更 * 跨網格複寫 * 稽核類別的設定、以管理稽核訊息的數量：
+
*** * 錯誤 * （預設）：稽核輸出中僅包含失敗的跨網格複寫要求。
*** * 正常 * ：包含所有跨網格複寫要求、大幅增加稽核輸出的容量。


.. 檢閱您的選擇。除非兩個貯體都是空的、否則您無法變更這些設定。
.. 選取 * 啟用和測試 * 。
+
片刻之後，會出現成功訊息。新增至此儲存桶的物件現在會自動複製到另一個網格。  *跨網格複製*在儲存桶詳細資料頁面上顯示為已啟用的功能。



. 或者link:../admin/grid-federation-what-is-cross-grid-replication.html["雙向啟用跨網格複寫"]、前往其他網格和上的對應儲存格。




== 測試網格之間的複寫

如果已為貯體啟用跨網格複寫、您可能需要驗證連線和跨網格複寫是否正常運作、以及來源和目的地貯體是否仍符合所有需求（例如、版本設定仍為啟用狀態）。

.開始之前
* 您正在使用link:../admin/web-browser-requirements.html["支援的網頁瀏覽器"]。
* 您屬於具有的使用者群組link:tenant-management-permissions.html["root 存取權限"]。


.步驟
. 登入貯體的租戶帳戶。
. 從儀表板選取 * 檢視貯體 * 、或選取 * 儲存空間（ S3 ） * > * 鏟斗 * 。
. 從表格中選取貯體名稱、以存取貯體詳細資料頁面。
. 選取 * 跨網格複寫 * 標籤。
. 選擇*測試連線*。
+
如果連接正常，則會出現成功橫幅。否則，會出現一條錯誤訊息，您和網格管理員可以使用它來解決問題。有關詳細信息，請參閱link:../admin/grid-federation-troubleshoot.html["疑難排解網格同盟錯誤"]。

. 如果跨網格複寫設定為雙向進行、請前往另一個網格上的對應儲存格、然後選取 * 測試連線 * 、確認跨網格複寫在另一個方向上運作。




== 停用跨網格複寫

如果您不想再將物件複製到其他網格、可以永久停止跨網格複寫。

停用跨網格複寫之前、請注意下列事項：

* 停用跨網格複製不會刪除任何已在網格之間複製的物件。例如， `my-bucket`網格 1 上已複製到 `my-bucket`如果您停用該儲存桶的跨網格複製，則網格 2 上的資料不會被刪除。如果要刪除這些對象，則必須手動將其刪除。
* 如果已為每個貯體啟用跨網格複寫（也就是說、如果雙向進行複寫）、您可以停用其中一個或兩個貯體的跨網格複寫。例如、您可能想要停用從「在網格 1 」複寫物件 `my-bucket`至 `my-bucket`「在網格 2 」、同時繼續將物件從「在網格 2 」複寫 `my-bucket`至 `my-bucket`「在網格 1 」。
* 您必須先停用跨網格複製，然後才能刪除租用戶使用網格聯合連線的權限。請參閱link:../admin/grid-federation-manage-tenants.html["管理允許的租戶"] 。
* 如果您停用包含對象的儲存桶的跨網格複製，除非您從來源儲存桶和目標儲存桶中刪除所有對象，否則您將無法重新啟用跨網格複製。
+

CAUTION: 除非兩個儲存區都是空的、否則無法重新啟用複寫。



.開始之前
* 您正在使用link:../admin/web-browser-requirements.html["支援的網頁瀏覽器"]。
* 您屬於具有的使用者群組link:tenant-management-permissions.html["root 存取權限"]。


.步驟
. 從您不再想複寫物件的網格開始、停止貯體的跨網格複寫：
+
.. 登入貯體的租戶帳戶。
.. 從儀表板選取 * 檢視貯體 * 、或選取 * 儲存空間（ S3 ） * > * 鏟斗 * 。
.. 從表格中選取貯體名稱、以存取貯體詳細資料頁面。
.. 選取 * 跨網格複寫 * 標籤。
.. 選取 * 停用複寫 * 。
.. 如果您確定要停用此儲存桶的跨網格複製，請在文字方塊中鍵入*是*，然後選擇*停用*。
+
稍後會出現成功訊息。新增至此貯體的物件無法再自動複寫到其他網格。* 跨網格複寫 * 不再顯示為「已啟用」功能。



. 如果跨網格複寫設定為雙向進行、請移至另一個網格上的對應儲存格、並在另一個方向停止跨網格複寫。

